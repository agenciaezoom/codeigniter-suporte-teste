"use strict";var images=[];function updateDeletePhotos(){var e=[];$(".imageOlds .checkbox-custom :checkbox:checked").each(function(){e.push($(this).parents(".template-upload").data("id"))}),$("#deleteImages").val(e.join(","))}function updateDeleteFiles(){var e=[];$(".fileOlds .checkbox-custom :checkbox:checked").each(function(){e.push($(this).parents(".template-upload").data("id"))}),$("#deleteFiles").val(e.join(","))}function getFilePreview(e){var a=e.split(".");return"<div class='file-preview'>"+(a=a.pop().toUpperCase())+"</div>"}function setOrderFiles(){$(".template-upload").each(function(e,a){$(this).find(".image-order").val(e+1)})}function formatSelect(e){return e.id?$("<span><img class='img-flag' src='"+base_img+"/"+$(e.element).data("image")+"'/> "+e.text+"</span>"):e.text}$(function(){var e=window.location.href.split("/").pop();"cadastrar"==e&&$(".sort-images-gallery").css({display:"none"}),$(".template-upload select").select2({templateResult:formatSelect,templateSelection:formatSelect}),$(document).on("click",".highlighted",function(){var e=$(this).find('input[type="checkbox"]');$('.highlighted input[type="checkbox"]').prop("checked",!1),$(".highlighted").removeClass("checked"),$(this).addClass("checked"),e.prop("checked",!0)}),$(".fileUploadImage").length>0&&($(".fileUploadImage").each(function(){var e=$(this),a=e.closest(".gallery-images").find(".imagesAll").data();e.fileupload({autoUpload:!1,dataType:"json",maxChunkSize:void 0!==a.gallerychunk&&1e6,pasteZone:null,previewMaxWidth:170,previewMaxHeight:170,previewCrop:!0,url:site_url+"gallery/upload",progress:function(e,a){var t=parseInt(a.loaded/a.total*100,10);$("#"+a.divId+" .progress .progress-bar").css("width",t+"%"),100==t&&setTimeout(function(){$("#"+a.divId+" .progress").removeClass("active"),$("#"+a.divId+" .progress .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-success")},1e3)},processalways:function(e,t){var i=t.files[0],l="";if($("#upload_files").length>0){l=/\.(jpg|jpeg|png|doc|docx|pdf|xls|xlsx|mp4|mov)$/i;var s={layout:"top",text:"O arquivo '"+i.name+"' não será enviado.\n\nVocê pode enviar arquivos com extensão: JPG, JPEG, PNG, DOC(X), XLS(X), PDF, MP4 ou MOV.",type:"error"}}else{l=/\.(jpg|jpeg|png)$/i;s={layout:"top",text:"O arquivo '"+i.name+"' não será enviado.\n\nVocê pode enviar arquivos com extensão:\nImagens: JPG, JPEG ou PNG.",type:"error"}}if(!l.test(i.name))return openNotification(s),!1;if("-1"!=t.paramName.indexOf("[]")){for(var d="img"+Math.floor(1e6*Math.random()),n=$("#"+d);0!=n.length;)d="img"+Math.floor(1e6*Math.random()),n=$("#"+d);t.divId=d;var o='<div class="template-upload fade in new" data-id="'+t.divId+'" id="'+t.divId+'">                                        <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-info" style="width:0%;"></div></div>                                        <span class="preview">                                            <div class="highlighted">                                                <input type="checkbox" name="'+a.gallerytype+"["+t.divId+'][highlighted]" />                                            </div>                                        </span>';Object.keys(languages).length>1&&a.multilang?($.each(languages,function(e,i){var l=current_lang!=i.code?" hide":"";o+='<p class="name language'+e+l+'"><input type="text" name="'+a.gallerytype+"["+t.divId+"][subtitle]["+e+']" class="form-control" placeholder="Legenda" value="" /></p>'}),o+='<select name="'+a.gallerytype+"["+t.divId+'][id_language]" class="form-control change-language" >',$.each(languages,function(e,a){var t=current_lang==a.code?' selected="selected" ':"";o+="<option "+t+' data-image="'+a.image+'" value="'+e+'" >'+a.code.toUpperCase()+"</option>"}),o+="</select>"):o+='<p class="name"><input type="text" name="'+a.gallerytype+"["+t.divId+'][subtitle]" class="form-control" placeholder="Legenda" value="" /></p>',o+='<button class="btn btn-danger btn-stroke cancel">                                            <i class="glyphicon glyphicon-trash"></i>                                        </button>                                        <strong class="error text-danger"></strong>                                    </div>';var c="."+t.paramName.replace("[]","");$(c).append(o),images.push(t),files.push(t);var r=t.files[0].type.split("/");"image"==r[0]?(console.log(t.files[0]),$(c+" #"+t.divId).find(".preview").append(t.files[0].preview)):"video"==r[0]?$(c+" #"+t.divId).find(".preview").append(t.files[0].preview):$(c+" #"+t.divId).find(".preview").append(getFilePreview(t.files[0].name)).css({"margin-bottom":"16px"}),$(".radio-custom > input[type=radio]").each(function(){$(this).data("radio")}),$(c+" #"+t.divId+" select").select2({templateResult:formatSelect,templateSelection:formatSelect})}},submit:function(e,t){t.formData=a},done:function(e,t){if($.each(files,function(e,a){if(a.divId==t.divId)return a.textStatus=t.textStatus,!1}),t.jqXHR.responseJSON.status){var i=$("#"+t.divId).find('input[name="'+a.gallerytype+"["+t.divId+'][highlighted]"]').is(":checked")?1:0;if($(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+'][image]" value="'+t.jqXHR.responseJSON.file_id+'" />'),$(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+'][order_by]" value="'+($("#"+t.divId).prevAll(".template-upload").length+1)+'" />'),$(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+'][type]" value="'+a.gallerytype+'" />'),Object.keys(languages).length>1&&a.multilang)$.each(languages,function(e,i){var l=$("#"+t.divId).find('input[name="'+a.gallerytype+"["+t.divId+"][subtitle]["+e+']"]').val();$(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+"][subtitle]["+e+']" value="'+l+'" />')});else{var l=$("#"+t.divId).find('input[name="'+a.gallerytype+"["+t.divId+'][subtitle]"]').val();$(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+'][subtitle]" value="'+l+'" />')}i&&$(".imageInputs").append('<input type="hidden" name="gallery['+t.divId+'][highlighted]" value="'+i+'" />')}sendForm($("#validateSubmitForm"))}})}),$(".imagesAll, .filesAll").on("click",".cancel",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).closest(".template-upload").data("id");for(i in files)a==files[i].divId&&files.splice(i,1);for(i in images)a==images[i].divId&&images.splice(i,1);$(this).closest(".template-upload").remove(),setOrderFiles()}),$(".fileupload-buttonbar .cancel").click(function(e){if(e.preventDefault(),e.stopPropagation(),!$(this).hasClass("btn-default")){for(i in images)for(j in files)images[i].divId==files[j].divId&&files.splice(j,1);images=[],$(this).closest(".gallery-images").find(".template-upload:not(.old)").remove(),setOrderFiles()}})),$("body").on("change",".deleteAll",function(){var e="inputFileDeleteAll"==$(this).attr("id")?$(".fileOlds"):$(".imageOlds");$(this).is(":checked")?($(this).siblings("i").addClass("checked"),e.find(".checkbox-custom :checkbox").prop("checked",!0).trigger("change").siblings("i").addClass("checked")):($(this).siblings("i").removeClass("checked"),e.find(".checkbox-custom :checkbox").prop("checked",!1).trigger("change").siblings("i").removeClass("checked")),"inputFileDeleteAll"==$(this).attr("id")?updateDeleteFiles():updateDeletePhotos()}),$("body").on("change",".deleteIndividual .checkbox-custom :checkbox",function(){var e=$(this).closest(".deleteIndividual").hasClass("imageOlds")?$("#inputPhotoDeleteAll"):$("#inputFileDeleteAll");$(this).is(":checked")?$(this).siblings("i").addClass("checked"):$(this).siblings("i").removeClass("checked"),$(this).closest(".deleteIndividual").find(".checkbox-custom :checkbox:checked").size()==$(this).closest(".deleteIndividual").find(".checkbox-custom :checkbox").size()?e.prop("checked",!0).siblings("i").addClass("checked"):e.prop("checked",!1).siblings("i").removeClass("checked"),$(this).closest(".deleteIndividual").hasClass("imageOlds")?updateDeletePhotos():updateDeleteFiles()}),$("body").on("change","select.change-language",function(){$(this).parent().find(".name").addClass("hide"),$(this).parent().find(".name.language"+$(this).val()).removeClass("hide")}),"function"==typeof $.fn.sortable&&($(".imageOlds").length>0||$(".fileOlds").length>0)&&($(".imageOlds, .fileOlds").sortable({update:function(a,t){var i;i=$(this).hasClass("imagesAll")?".imageOlds":".fileOlds",$(".sort-info > i").animate({opacity:"1"},100);var l=[];$(i+" .template-upload:not(.new)").each(function(){l.push($(this).data("id"))}),"cadastrar"!=e&&$.ajax({data:{order:l.join(","),id:$("#inputId").val(),gallerytable:$(this).closest(".deleteIndividual").data("gallerytable")},dataType:"json",url:site_url+"gallery/sort-images",type:"POST",success:function(e){var a={layout:"top",text:e.message,type:e.classe};openNotification(a),$(".sort-info > i").animate({opacity:"0"},250),setOrderFiles()}})}}),$(".imageOlds, .fileOlds").on("click",".delete",function(e){e.preventDefault(),e.stopPropagation();var a=$(this).closest(".template-upload").data("id");for(var t in files)a==files[t].divId&&files.splice(t,1);for(var t in images)a==images[t].divId&&images.splice(t,1);var i=$(this);bootbox.confirm("Você tem certeza que deseja excluir esta imagem?",function(e){e&&$.ajax({type:"POST",url:site_url+"gallery/delete-image",data:{ids:i.closest(".template-upload").data("id"),gallerytable:i.closest(".deleteIndividual").data("gallerytable"),gallerypath:i.closest(".deleteIndividual").data("gallerypath")},dataType:"json",success:function(e){var a={layout:"top",text:e.message,type:e.classe};openNotification(a),i.closest(".template-upload").animate({opacity:0},700,function(){$(this).remove(),0==$(".imageOlds .template-upload").length&&$(this).closest(".col-xs-12").find('input[type="hidden"][id^="#delete"], .delete-all, label[for$="DeleteAll"]').fadeOut(600,function(){$(this).remove()}),setOrderFiles()})}})})}),$(".gallery-images").on("click",".delete-all",function(e){e.preventDefault(),e.stopPropagation();var a,t,i,l,s=[],d=$(this);if(d.closest(".gallery-images").find(".deleteIndividual").hasClass("imagesAll")?(t="inputPhotoDeleteAll",i="#deleteImages",l=".imageOlds"):(t="inputFileDeleteAll",i="#deleteFiles",l=".fileOlds"),!$(this).hasClass("btn-default")){for(var n in images)for(j in files)images[n].divId==files[j].divId&&files.splice(j,1);images=[],$(this).closest(".gallery-images").find(".template-upload:not(.old)").remove(),setOrderFiles()}(a=$(l+" .checkbox-custom :checkbox:checked").parents(".template-upload")).each(function(){s.push($(this).data("id"))}),s.length>0&&bootbox.confirm("Você tem certeza que deseja excluir estes itens?",function(e){e&&$.ajax({type:"POST",url:site_url+"gallery/delete-image",data:{ids:s.join(","),gallerytable:d.closest(".gallery-images").find(".deleteIndividual").data("gallerytable"),gallerypath:d.closest(".gallery-images").find(".deleteIndividual").data("gallerypath")},dataType:"json",success:function(e){var s={layout:"top",text:e.message,type:e.classe};openNotification(s),a.each(function(){$(this).animate({opacity:0},700,function(){$(this).remove(),0==$(l+" .template-upload").length&&$(l).parents(".col-xs-12").find(i+', .delete-all, label[for="'+t+'"]').fadeOut(600,function(){$(this).remove()}),setOrderFiles()})}),$("#"+t).prop("checked",!1).siblings("i").removeClass("checked")}})})}))}),Comum.cropImage();