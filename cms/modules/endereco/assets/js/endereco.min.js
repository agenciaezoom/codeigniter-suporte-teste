"use strict";function Endereco(){this.init()}Endereco.prototype.vars={autoCity:"",map:void 0,marker:!1,rendered:!1,scripts:!1,trigger:!1},Endereco.prototype.init=function(){this.formListeners()},Endereco.prototype.formListeners=function(){var e=this;if(!e.vars.scripts){if(e.vars.scripts=!0,$("#address-sidebar select.select2:not(.select2-offscreen)").length>0&&$("#address-sidebar select.select2:not(.select2-offscreen)").select2(),$.extend($.inputmask.defaults,{autounmask:!0,clearMaskOnLostFocus:!0,placeholder:"_"}),$("#address-sidebar").on("keyup",'[name*="zip_code"]',function(){if(32==$("#inputCountry").val()){var a=$.trim($(this).val().replace(/\D/g,"")),t=$(this);if(8==a.length&&a!=t.data("old")){t.data("old",a),t.addClass("loading");var n=t.closest(".address-wrapper");$.getJSON(site_url+"endereco/get",{zipcode:a},function(a){a&&(n.find('input:not([name*="zip_code"])').val(""),n.find('[name*="state"]').val(states[unescape(a.uf)]),n.find('[name*="city"]').val(unescape(a.cidade)),n.find('[name*="suburb"]').val(unescape(a.bairro)),n.find('[name*="street"]').val(unescape(a.logradouro)),n.find('[name*="number"]').focus(),e.initMaps(),$(".address-wrapper .alert").fadeOut(100),setTimeout(function(){$(".find-place").trigger("click")},150)),t.removeClass("loading")})}}}),$('[name*="id_country"]').data("old",$('[name*="id_country"]').val()).on("change",function(){var e=$(this).val();32==e?$("#inputCEP").inputmask({mask:"99999-999",keepStatic:!0}):$("#inputCEP").inputmask("remove"),e!=$(this).data("old")&&($(this).data("old",e),$("#address-sidebar input").val(""),32==e?$(".address-wrapper .alert").fadeIn(100):$(".address-wrapper .alert").fadeOut(100))}).trigger("change"),$("#address-map").length){var a=[site_url+"modules/comum/assets/plugins/jquery-ui-map/jquery.ui.map.js",site_url+"modules/comum/assets/plugins/jquery-ui-map/jquery.ui.map.extensions.js",site_url+"modules/comum/assets/plugins/jquery-ui-map/jquery.ui.map.services.js"];$.each(a,function(e,a){if($('[src="'+a+'"]').length)return!0;var t=document.createElement("script");t.src=a,$("head").prepend($(t))})}$(".address-wrapper").closest(".tab-pane").length>0&&($(".address-wrapper").closest(".tab-pane").hasClass("active")?e.initMaps():$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){$($(e.target).attr("href")).find("#address-map").length}))}},Endereco.prototype.initMaps=function(){var e=this;e.vars.rendered||(e.vars.rendered=!0,$("#address-map").length&&($("#address-map").height($(window).height()-($("footer").height()+$("header").height()+$(".breadcrumb").height()+91)),$(window).on("resize.endereco",function(){$("#address-map").height($(window).height()-($("footer").height()+$("header").height()+$(".breadcrumb").height()+91))}).trigger("resize.endereco"),$("#address-map").gmap({panControl:!1,streetViewControl:!1,mapTypeControl:!1,overviewMapControl:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:12,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_RIGHT}}).bind("init",function(a,t){e.vars.map=$("#address-map").gmap("get","map");var n=new google.maps.OverlayView;if(n.draw=function(){},n.setMap(e.vars.map),google.maps.event.addDomListener(window,"resize",function(){e.centerMap()}),""!=$('#address-sidebar input[name*="lat"]').val()&&""!=$('#address-sidebar input[name*="lng"]').val()){var o=$('#address-sidebar input[name*="lat"]').val(),s=$('#address-sidebar input[name*="lng"]').val();$("#address-map").gmap("addMarker",{position:new google.maps.LatLng(o,s),draggable:!0,bounds:!1,animation:google.maps.Animation.DROP},function(a,t){$("#address-map").gmap("option","center",t.getPosition()),$("#address-map").gmap("option","zoom",15),e.vars.marker=t}).dragend(function(a){this.setAnimation(google.maps.Animation.BOUNCE),setTimeout($.proxy(function(){this.setAnimation(null)},this),600),e.findPlace(a.latLng,this)})}else $("#address-map").gmap("option","center",new google.maps.LatLng(-29.1655089,-51.173753)),$("#address-map").gmap("option","zoom",12)}),$(".find-place").on("click",function(a){a.preventDefault(),a.stopPropagation(),e.initMaps();var t={},n="";if($('#address-sidebar [name^="location"]').each(function(){t[this.name.match(/\[(.*?)\]/)[1]]=$(this).val()}),null!=t.street&&""!=t.street&&(n+=t.street,""!=t.number&&(n+=", "+t.number)),null!=t.city&&""!=t.city&&(n+=n.length>0?", ":"",n+=$('[name*="city"]').val()),null!=t.state&&""!=t.state&&(n+=n.length>0?", ":"",n+=$('[name*="state"]').val()),0==n.length&&""!=t.zip_code&&(n+=t.zip_code),null!=t.id_country&&""!=t.id_country&&(n+=n.length>0?", ":"",n+=$('[name*="id_country"] option[value="'+t.id_country+'"]').text()),0!=n.length)$("#address-map").gmap("search",{address:n},function(a,t){if("OK"===t){var n=a[0].geometry.location.lat(),o=a[0].geometry.location.lng();e.configInputs(a,!1),e.vars.marker&&e.vars.marker.setMap(null),$("#address-map").gmap("addMarker",{position:new google.maps.LatLng(n,o),draggable:!0,bounds:!1,animation:google.maps.Animation.DROP},function(a,t){$("#address-map").gmap("option","center",t.getPosition()),$("#address-map").gmap("option","zoom",15),e.vars.marker=t}).dragend(function(a){this.setAnimation(google.maps.Animation.BOUNCE),setTimeout($.proxy(function(){this.setAnimation(null)},this),600),e.findPlace(a.latLng,this)})}});else{var o={layout:"top",text:i18n.preencha_localizacao,type:"error"};openNotification(o)}})))},Endereco.prototype.centerMap=function(){this.vars.marker&&$("#address-map").gmap("option","center",this.vars.marker.getPosition())},Endereco.prototype.findPlace=function(e,a){var t=this;t.initMaps(),$("#address-map").gmap("search",{location:e},function(e,a){"OK"===a&&t.configInputs(e,!0)})},Endereco.prototype.configInputs=function(e,a){var t={};if($.each(e[0].address_components,function(e,a){t[a.types[0]]={short_name:void 0!==a.short_name?a.short_name:"",long_name:void 0!==a.long_name?a.long_name:""}}),void 0!==t.country&&void 0!==t.country.short_name&&$('#address-sidebar select[name*="id_country"]').val($('#address-sidebar select[name*="id_country"] option[data-code="'+t.country.short_name+'"]').attr("value")).trigger("change"),void 0!==t.postal_code)(a||""==$('#address-sidebar input[name*="zip_code"]').val())&&$('#address-sidebar input[name*="zip_code"]').val(t.postal_code.long_name).data("old",t.postal_code.long_name);else if(void 0!==t.postal_code_prefix){if(a||""==$('#address-sidebar input[name*="zip_code"]').val()){var n=t.postal_code_prefix.long_name+"-"+(void 0!==t.postal_code_sufix?t.postal_code_sufix.long_name:"000");$('#address-sidebar input[name*="zip_code"]').val(n).data("old",n)}}else a&&$('#address-sidebar input[name*="zip_code"]').val("").data("old","");a&&void 0!==t.administrative_area_level_1&&$('#address-sidebar [name*="state"]').val(t.administrative_area_level_1.long_name);var o=void 0!==t.locality?t.locality.long_name:void 0!==t.administrative_area_level_2.long_name?t.administrative_area_level_2.long_name:"";$('#address-sidebar [name*="city"]').val(o),!a||void 0!==t.route&&void 0!==t.route===$('#address-sidebar input[name*="street"]').val()||$('#address-sidebar input[name*="additional_info"]').val(""),(a||""==$('#address-sidebar input[name*="suburb"]').val())&&$('#address-sidebar input[name*="suburb"]').val(void 0!==t.neighborhood?t.neighborhood.long_name:void 0!==t.sublocality_level_1?t.sublocality_level_1.long_name:""),(a||""==$('#address-sidebar input[name*="street"]').val())&&$('#address-sidebar input[name*="street"]').val(void 0!==t.route?t.route.long_name:"");var s=e[0].geometry.location.lat(),i=e[0].geometry.location.lng();$('#address-sidebar input[name*="lat"]').val(s),$('#address-sidebar input[name*="lng"]').val(i)},$("document").ready(function(){new Endereco});